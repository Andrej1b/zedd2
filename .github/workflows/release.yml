name: Release
on: push
#  push:
#    tags:
#      - '*'

jobs:
  publish:
    strategy:
      matrix:
        #os: [windows-latest, macos-latest, ubuntu-latest]
        os: [windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@master
        with:
          node-version: 14

      - name: install clarity dependencies
        working-directory: ./zedd-clarity
        run: npm install
      - name: build clarity
        working-directory: ./zedd-clarity
        run: npm run build

      - name: install app dependencies
        working-directory: ./zedd-app
        run: npm install
      - name: generate icons
        working-directory: ./zedd-app
        run: npm run genicons
      - name: build release
        working-directory: ./zedd-app
        run: npm run package
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          #tag_name: ${{ github.ref }}
          #name: Release ${{ github.ref }}
          tag_name: 0.0.1-beta
          name: Release 0.0.1-beta
          draft: true
          files: |
            ./zedd-app/dist/*.snap
            ./zedd-app/dist/*.dmg
            ./zedd-app/dist/*.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
